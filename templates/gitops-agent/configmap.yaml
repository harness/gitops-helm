apiVersion: v1
data:
  GITOPS_ACCOUNT_IDENTIFIER: {{ .Values.harness.identity.accountId }}
  GITOPS_AGENT_IDENTIFIER: {{ .Values.harness.identity.agentId }}
  {{- if ne .Values.harness.identity.orgId "" }}
  GITOPS_ORG_IDENTIFIER: {{ .Values.harness.identity.orgId }}
  {{- end }}
  {{- if ne .Values.harness.identity.projectId "" }}
  GITOPS_PROJECT_IDENTIFIER: {{ .Values.harness.identity.projectId }}
  {{- end }}
  {{- if .Values.harness.disasterRecovery.enabled }}
  GITOPS_DISASTER_RECOVERY_IDENTIFIER: {{ .Values.harness.disasterRecovery.identifier }}
  {{- end }}
  GITOPS_SERVICE_HTTP_TLS_ENABLED: "{{ .Values.harness.configMap.http.tlsEnabled }}"
  GITOPS_SERVICE_HTTP_CERT_FILES: {{ .Values.harness.configMap.http.certPath }}
  AGENT_HTTP_TARGET: {{ .Values.harness.configMap.http.agentHttpTarget }}
  AGENT_GRPC_TARGET: {{ .Values.harness.configMap.grpc.agentGrpcTarget }}
  AGENT_GRPC_AUTHORITY: {{ .Values.harness.configMap.grpc.agentGrpcAuthority }}
  GITOPS_SERVICE_GRPC_INSECURE: "{{ .Values.harness.configMap.grpc.serviceGrpcInsecure }}"
  GITOPS_SERVICE_PROTOCOL: {{ .Values.harness.configMap.agentProtocol }}
  GITOPS_AGENT_ENABLE_RECONCILE: "{{ .Values.harness.configMap.reconcile.enabled }}"
  GITOPS_AGENT_RECONCILE_INTERVAL: "{{ .Values.harness.configMap.reconcile.interval }}"
  GITOPS_AGENT_DISCOVER_APPLICATION_PODS_DURATION_IN_SECS: "{{ .Values.harness.configMap.reconcile.podsDiscovery }}"
  LOG_LEVEL: {{ .Values.harness.configMap.logLevel }}
  GITOPS_AGENT_FETCH_TYPE: "{{ .Values.harness.configMap.agentFetchType }}"
  REDIS_COMPRESSION: "{{ .Values.harness.configMap.redisCompression }}"
  {{-  if .Values.agent.proxy.enabled }}
  HTTPS_PROXY: {{ .Values.agent.proxy.httpsProxy }}
  HTTP_PROXY: {{ .Values.agent.proxy.httpProxy }}
  NO_PROXY: localhost,argocd-repo-server,argocd-redis,127.0.0.1,argocd-redis-ha-haproxy,$(KUBERNETES_SERVICE_HOST),kubernetes.default.svc,{{ .Values.agent.name }}
  {{- end }}
kind: ConfigMap
metadata:
  labels:
      {{- include "harness.labels" (dict "context" . "component" .Values.agent.name "name" (printf "%s-cm" .Values.agent.name)) | nindent 4 }}
  name: {{ .Values.agent.name }}
  namespace: {{ .Release.Namespace }}
